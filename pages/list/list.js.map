{"version":3,"sources":["pages/list/list.js"],"names":["app","getApp","Page","data","title","subtitle","type","loading","hasMore","page","size","movies","loadMore","setData","douban","find","then","d","subjects","length","concat","catch","console","error","e","onLoad","params","onReady","wx","setNavigationBarTitle","onPullDownRefresh","wechat","original","stopPullDownRefresh","onReachBottom"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;;AAEA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,WAAO,EADH;AAEJC,cAAU,QAFN;AAGJC,UAAM,aAHF;AAIJC,aAAS,IAJL;AAKJC,aAAS,IALL;AAMJC,UAAM,CANF;AAOJC,UAAM,EAPF;AAQJC,YAAQ;AARJ,GAJH;;AAeHC,UAfG,sBAeS;AAAA;;AACV,QAAI,CAAC,KAAKT,IAAL,CAAUK,OAAf,EAAwB;;AAExB,SAAKK,OAAL,CAAa,EAAER,UAAU,QAAZ,EAAsBE,SAAS,IAA/B,EAAb;;AAEA,WAAOP,IAAIc,MAAJ,CAAWC,IAAX,CAAgB,KAAKZ,IAAL,CAAUG,IAA1B,EAAgC,KAAKH,IAAL,CAAUM,IAAV,EAAhC,EAAkD,KAAKN,IAAL,CAAUO,IAA5D,EACJM,IADI,CACC,aAAK;AACT,UAAIC,EAAEC,QAAF,CAAWC,MAAf,EAAuB;AACrB,cAAKN,OAAL,CAAa,EAAER,UAAUY,EAAEb,KAAd,EAAqBO,QAAQ,MAAKR,IAAL,CAAUQ,MAAV,CAAiBS,MAAjB,CAAwBH,EAAEC,QAA1B,CAA7B,EAAkEX,SAAS,KAA3E,EAAb;AACD,OAFD,MAEO;AACL,cAAKM,OAAL,CAAa,EAAER,UAAUY,EAAEb,KAAd,EAAqBI,SAAS,KAA9B,EAAqCD,SAAS,KAA9C,EAAb;AACD;AACF,KAPI,EAQJc,KARI,CAQE,aAAK;AACV,YAAKR,OAAL,CAAa,EAAER,UAAU,QAAZ,EAAsBE,SAAS,KAA/B,EAAb;AACAe,cAAQC,KAAR,CAAcC,CAAd;AACD,KAXI,CAAP;AAYD,GAhCE;;;AAkCH;;;AAGAC,QArCG,kBAqCKC,MArCL,EAqCa;AACd,SAAKvB,IAAL,CAAUC,KAAV,GAAkBsB,OAAOtB,KAAP,IAAgB,KAAKD,IAAL,CAAUC,KAA5C;;AAEA;AACA,SAAKD,IAAL,CAAUG,IAAV,GAAiBoB,OAAOpB,IAAP,IAAe,KAAKH,IAAL,CAAUG,IAA1C;;AAEA,SAAKM,QAAL;AACD,GA5CE;;;AA8CH;;;AAGAe,SAjDG,qBAiDQ;AACTC,OAAGC,qBAAH,CAAyB,EAAEzB,OAAO,KAAKD,IAAL,CAAUC,KAAV,GAAkB,YAA3B,EAAzB;AACD,GAnDE;;;AAqDH;;;AAGA0B,mBAxDG,+BAwDkB;AACnB,SAAKjB,OAAL,CAAa,EAAEF,QAAQ,EAAV,EAAcF,MAAM,CAApB,EAAuBD,SAAS,IAAhC,EAAb;AACA,SAAKI,QAAL,GACGI,IADH,CACQ;AAAA,aAAMhB,IAAI+B,MAAJ,CAAWC,QAAX,CAAoBC,mBAApB,EAAN;AAAA,KADR;AAED,GA5DE;AA8DHC,eA9DG,2BA8Dc;AACf,SAAKtB,QAAL;AACD;AAhEE,CAAL","file":"list.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: '',\n    subtitle: '加载中...',\n    type: 'in_theaters',\n    loading: true,\n    hasMore: true,\n    page: 1,\n    size: 20,\n    movies: []\n  },\n\n  loadMore () {\n    if (!this.data.hasMore) return\n\n    this.setData({ subtitle: '加载中...', loading: true })\n\n    return app.douban.find(this.data.type, this.data.page++, this.data.size)\n      .then(d => {\n        if (d.subjects.length) {\n          this.setData({ subtitle: d.title, movies: this.data.movies.concat(d.subjects), loading: false })\n        } else {\n          this.setData({ subtitle: d.title, hasMore: false, loading: false })\n        }\n      })\n      .catch(e => {\n        this.setData({ subtitle: '获取数据异常', loading: false })\n        console.error(e)\n      })\n  },\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad (params) {\n    this.data.title = params.title || this.data.title\n\n    // 类型： in_theaters  coming_soon  us_box\n    this.data.type = params.type || this.data.type\n\n    this.loadMore()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    wx.setNavigationBarTitle({ title: this.data.title + ' « 电影 « 豆瓣' })\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.setData({ movies: [], page: 1, hasMore: true })\n    this.loadMore()\n      .then(() => app.wechat.original.stopPullDownRefresh())\n  },\n\n  onReachBottom () {\n    this.loadMore()\n  }\n})\n"]}