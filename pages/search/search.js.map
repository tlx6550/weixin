{"version":3,"sources":["pages/search/search.js"],"names":["app","getApp","Page","data","page","size","subtitle","movies","search","loading","hasMore","loadMore","setData","douban","find","then","d","subjects","length","title","concat","catch","console","error","e","handleSearch","detail","value","onPullDownRefresh","wechat","original","stopPullDownRefresh","onReachBottom"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;;AAEA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,UAAM,CADF;AAEJC,UAAM,EAFF;AAGJC,cAAU,WAHN;AAIJC,YAAQ,EAJJ;AAKJC,YAAQ,EALJ;AAMJC,aAAS,KANL;AAOJC,aAAS;AAPL,GAJH;;AAcHC,UAdG,sBAcS;AAAA;;AACV,QAAI,CAAC,KAAKR,IAAL,CAAUO,OAAf,EAAwB;;AAExB,SAAKE,OAAL,CAAa,EAAEN,UAAU,QAAZ,EAAsBG,SAAS,IAA/B,EAAb;;AAEA,WAAOT,IAAIa,MAAJ,CAAWC,IAAX,CAAgB,QAAhB,EAA0B,KAAKX,IAAL,CAAUC,IAAV,EAA1B,EAA4C,KAAKD,IAAL,CAAUE,IAAtD,EAA4D,KAAKF,IAAL,CAAUK,MAAtE,EACJO,IADI,CACC,aAAK;AACT,UAAIC,EAAEC,QAAF,CAAWC,MAAf,EAAuB;AACrB,cAAKN,OAAL,CAAa,EAAEN,UAAUU,EAAEG,KAAd,EAAqBZ,QAAQ,MAAKJ,IAAL,CAAUI,MAAV,CAAiBa,MAAjB,CAAwBJ,EAAEC,QAA1B,CAA7B,EAAkER,SAAS,KAA3E,EAAb;AACD,OAFD,MAEO;AACL,cAAKG,OAAL,CAAa,EAAEF,SAAS,KAAX,EAAkBD,SAAS,KAA3B,EAAb;AACD;AACF,KAPI,EAQJY,KARI,CAQE,aAAK;AACV,YAAKT,OAAL,CAAa,EAAEN,UAAU,QAAZ,EAAsBG,SAAS,KAA/B,EAAb;AACAa,cAAQC,KAAR,CAAcC,CAAd;AACD,KAXI,CAAP;AAYD,GA/BE;AAiCHC,cAjCG,wBAiCWD,CAjCX,EAiCc;AACf,QAAI,CAACA,EAAEE,MAAF,CAASC,KAAd,EAAqB;AACrB,SAAKf,OAAL,CAAa,EAAEL,QAAQ,EAAV,EAAcH,MAAM,CAApB,EAAb;AACA,SAAKQ,OAAL,CAAa,EAAEN,UAAU,QAAZ,EAAsBI,SAAS,IAA/B,EAAqCD,SAAS,IAA9C,EAAoDD,QAAQgB,EAAEE,MAAF,CAASC,KAArE,EAAb;;AAEA,SAAKhB,QAAL;AACD,GAvCE;;;AAyCH;;;AAGAiB,mBA5CG,+BA4CkB;AACnB,SAAKhB,OAAL,CAAa,EAAEL,QAAQ,EAAV,EAAcH,MAAM,CAApB,EAAb;AACA,SAAKO,QAAL,GACGI,IADH,CACQ;AAAA,aAAMf,IAAI6B,MAAJ,CAAWC,QAAX,CAAoBC,mBAApB,EAAN;AAAA,KADR;AAED,GAhDE;AAkDHC,eAlDG,2BAkDc;AACf,SAAKrB,QAAL;AACD;AApDE,CAAL","file":"search.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    page: 1,\n    size: 20,\n    subtitle: '请在此输入搜索内容',\n    movies: [],\n    search: '',\n    loading: false,\n    hasMore: false\n  },\n\n  loadMore () {\n    if (!this.data.hasMore) return\n\n    this.setData({ subtitle: '加载中...', loading: true })\n\n    return app.douban.find('search', this.data.page++, this.data.size, this.data.search)\n      .then(d => {\n        if (d.subjects.length) {\n          this.setData({ subtitle: d.title, movies: this.data.movies.concat(d.subjects), loading: false })\n        } else {\n          this.setData({ hasMore: false, loading: false })\n        }\n      })\n      .catch(e => {\n        this.setData({ subtitle: '获取数据异常', loading: false })\n        console.error(e)\n      })\n  },\n\n  handleSearch (e) {\n    if (!e.detail.value) return\n    this.setData({ movies: [], page: 1 })\n    this.setData({ subtitle: '加载中...', hasMore: true, loading: true, search: e.detail.value })\n\n    this.loadMore()\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.setData({ movies: [], page: 1 })\n    this.loadMore()\n      .then(() => app.wechat.original.stopPullDownRefresh())\n  },\n\n  onReachBottom () {\n    this.loadMore()\n  }\n})\n"]}